<!--
================================================================================
Email Mass Sender - Main HTML Template
================================================================================

This Thymeleaf template provides the main user interface for the Email Mass
Sender application. It includes a rich text editor with Outlook-style ribbon
toolbar, recipient management panel, and email sending controls.

Template Structure:
------------------
1. HEAD Section
   - Meta tags and viewport
   - External CSS (Bootstrap, Font Awesome)
   - Application CSS

2. MAIN CONTAINER (Two-Column Layout)
   2.1 Left Column - Compose Email
       - Subject line input
       - Outlook-style ribbon toolbar (2 rows)
       - Rich text editor (contenteditable div)
       - Template save/load buttons
       - Send options (Individual/Batch mode)
       - Send buttons (Test & Send All)

   2.2 Right Column - Recipients
       - Search box
       - Select All/None/Add buttons
       - Email list with checkboxes
       - Bulk edit button

3. OVERLAYS & MODALS
   - Error console (slide-up panel)
   - Status bar (fixed bottom)
   - Result modal
   - Add email modal
   - Bulk edit modal

4. SCRIPTS
   - Bootstrap bundle
   - Application JavaScript

Thymeleaf Variables:
-------------------
- ${emails}     : List<String> - All email addresses
- ${emailCount} : Integer - Total number of emails

Dependencies:
-------------
- Bootstrap 5.3.2
- Font Awesome 6.5.1
- /css/app.css
- /js/app.js

@author KiSoft
@version 1.0.0
@since 2025-12-26
================================================================================
-->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- ====================================================================
         HEAD SECTION
         - Character encoding and viewport for responsive design
         - External CSS libraries (Bootstrap for layout, Font Awesome for icons)
         - Application-specific styles
         ==================================================================== -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Mass Sender</title>

    <!-- Bootstrap 5.3.2 - CSS framework for responsive layout and components -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome 6.5.1 - Icon library for UI icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

    <!-- Application CSS - Custom styles for email sender UI -->
    <link href="/css/app.css" rel="stylesheet">
</head>
<body>
    <!-- ====================================================================
         MAIN CONTAINER
         Full-height container with two-column layout.
         Left: Email composition, Right: Recipients list
         ==================================================================== -->
    <div class="main-container">
        <div class="row equal-height">

            <!-- ============================================================
                 LEFT COLUMN - COMPOSE EMAIL
                 Contains:
                 - Subject line input
                 - Outlook-style formatting toolbar
                 - Rich text editor
                 - Template management
                 - Send options and buttons
                 ============================================================ -->
            <div class="col-compose">
                <div class="card h-100">
                    <!-- Card Header with title, menu bar, and branding -->
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center gap-3">
                                <span title="Email composition area"><i class="fas fa-edit"></i> Compose Email</span>
                                <!-- Menu Bar integrated into header -->
                                <ul class="nav nav-pills gap-2 header-menu">
                            <!-- File Menu -->
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">File</a>
                                <ul class="dropdown-menu">
                                    <li class="dropdown-header">Templates</li>
                                    <!-- Save Template Submenu -->
                                    <li class="dropdown dropend">
                                        <a class="dropdown-item dropdown-toggle" href="#" data-bs-toggle="dropdown">Save Template</a>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" href="#" id="saveTemplateSlot1" onclick="saveTemplate(1);return false;">Save to Slot 1</a></li>
                                            <li><a class="dropdown-item" href="#" id="saveTemplateSlot2" onclick="saveTemplate(2);return false;">Save to Slot 2</a></li>
                                            <li><a class="dropdown-item" href="#" id="saveTemplateSlot3" onclick="saveTemplate(3);return false;">Save to Slot 3</a></li>
                                            <li><a class="dropdown-item" href="#" id="saveTemplateSlot4" onclick="saveTemplate(4);return false;">Save to Slot 4</a></li>
                                            <li><a class="dropdown-item" href="#" id="saveTemplateSlot5" onclick="saveTemplate(5);return false;">Save to Slot 5</a></li>
                                        </ul>
                                    </li>
                                    <!-- Load Template Submenu -->
                                    <li class="dropdown dropend">
                                        <a class="dropdown-item dropdown-toggle" href="#" data-bs-toggle="dropdown">Load Template</a>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" href="#" onclick="loadTemplate(1);return false;">Load from Slot 1</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="loadTemplate(2);return false;">Load from Slot 2</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="loadTemplate(3);return false;">Load from Slot 3</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="loadTemplate(4);return false;">Load from Slot 4</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="loadTemplate(5);return false;">Load from Slot 5</a></li>
                                        </ul>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li class="dropdown-header">Export</li>
                                    <li><a class="dropdown-item" href="#" onclick="exportToTxt();return false;">Export to TXT</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="exportToPdf();return false;">Export to PDF</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="exportToHtml();return false;">Export to HTML</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="exportToDocx();return false;">Export to Microsoft Word</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#" onclick="printMessageEditor();return false;">Print…</a></li>
                                </ul>
                            </li>
                            <!-- Edit Menu -->
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">Edit</a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" onclick="execCmd('copy');return false;">Copy</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="execCmd('cut');return false;">Cut</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="execCmd('paste');return false;">Paste</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li class="dropdown-header">Photo</li>
                                    <li><a class="dropdown-item" href="#" onclick="photoCopy();return false;">Copy Photo</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="photoCut();return false;">Cut Photo</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="photoPaste();return false;">Paste Photo</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#" onclick="showPreviousResult();return false;">Previous Result</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="showNextResult();return false;">Next Result</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#" onclick="openConfiguration(true);return false;">Configuration…</a></li>
                                </ul>
                            </li>
                            <!-- View Menu -->
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">View</a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" onclick="setTheme('light');return false;">Light</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="setTheme('dark');return false;">Dark</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#" onclick="toggleInvisibleSymbols();return false;">Show/Hide Invisible Symbols</a></li>
                                </ul>
                            </li>
                            <!-- Help Menu -->
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">Help</a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" onclick="showAbout();return false;">About</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="showDetailDescription();return false;">Detail Description</a></li>
                                </ul>
                            </li>
                        </ul>
                            </div>
                            <span title="Web-List-EMailer Application"><i class="fas fa-envelope"></i> Email Mass Sender</span>
                        </div>
                    </div>
                    <div class="card-body d-flex flex-column">

                        <!-- ------------------------------------------------
                             MESSAGE EDITOR SECTION
                             Includes toolbar and contenteditable editor
                             ------------------------------------------------ -->
                        <div class="mb-2 flex-grow-1 d-flex flex-column">
                            <div class="d-flex align-items-center justify-content-between mb-1">
                                <div class="d-flex align-items-center flex-grow-1">
                                    <label class="form-label mb-0 me-3" style="white-space: nowrap;" title="Rich text email body editor - supports formatting, images, and links"><strong>Message Editor:</strong></label>
                                    <label for="subject" class="form-label mb-0 me-2" title="Email subject line - auto-filled with next Sunday's date"><strong>Subject:</strong></label>
                                    <input type="text" class="form-control" id="subject" placeholder="Subject will be filled automatically..." title="Enter the email subject line. Auto-filled with next Sunday's date on page load.">
                                </div>
                            </div>

                            <!-- ============================================
                                 EDITOR TOOLBAR - Organized by Functionality

                                 ROW 1: Clipboard | Font | Format | Colors
                                 ROW 2: Paragraph | Insert | Table | Image | View
                                 ============================================ -->
                            <div class="editor-ribbon-compact">

                                <!-- ROW 1: Clipboard | Font | Format | Colors -->
                                <div class="ribbon-row-compact">

                                    <!-- ═══════════ CLIPBOARD SECTION ═══════════ -->
                                    <div class="ribbon-section" title="Clipboard">
                                        <div class="ribbon-section-label">Clipboard</div>
                                        <div class="ribbon-group">
                                            <button type="button" class="btn btn-sm btn-outline-secondary ribbon-btn-paste" data-cmd="paste" title="Paste (Ctrl+V)"><i class="fas fa-paste"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="cut" title="Cut (Ctrl+X)"><i class="fas fa-cut"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="copy" title="Copy (Ctrl+C)"><i class="fas fa-copy"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="formatPainter" title="Format Painter"><i class="fas fa-paint-brush"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="undo" title="Undo (Ctrl+Z)"><i class="fas fa-undo"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="redo" title="Redo (Ctrl+Y)"><i class="fas fa-redo"></i></button>
                                        </div>
                                    </div>
                                    <div class="ribbon-separator"></div>

                                    <!-- ═══════════ FONT SECTION ═══════════ -->
                                    <div class="ribbon-section" title="Font">
                                        <div class="ribbon-section-label">Font</div>
                                        <div class="ribbon-group">
                                            <select class="form-select form-select-sm" id="fontFamily" title="Font Family">
                                                <option value="Arial">Arial</option>
                                                <option value="Calibri" selected>Calibri</option>
                                                <option value="Times New Roman">Times New Roman</option>
                                                <option value="Verdana">Verdana</option>
                                                <option value="Georgia">Georgia</option>
                                                <option value="Tahoma">Tahoma</option>
                                                <option value="Trebuchet MS">Trebuchet MS</option>
                                                <option value="Courier New">Courier New</option>
                                                <option value="Comic Sans MS">Comic Sans MS</option>
                                            </select>
                                            <select class="form-select form-select-sm" id="fontSize" title="Font Size">
                                                <option value="1">8</option>
                                                <option value="2">10</option>
                                                <option value="3">12</option>
                                                <option value="4" selected>14</option>
                                                <option value="5">18</option>
                                                <option value="6">24</option>
                                                <option value="7">36</option>
                                            </select>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="increaseFontSize" title="Grow Font"><i class="fas fa-font"></i><sup>▲</sup></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="decreaseFontSize" title="Shrink Font"><i class="fas fa-font" style="font-size:10px"></i><sub>▼</sub></button>
                                        </div>
                                    </div>
                                    <div class="ribbon-separator"></div>

                                    <!-- ═══════════ FORMAT SECTION ═══════════ -->
                                    <div class="ribbon-section" title="Format">
                                        <div class="ribbon-section-label">Format</div>
                                        <div class="ribbon-group">
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="bold" title="Bold (Ctrl+B)"><b>B</b></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="italic" title="Italic (Ctrl+I)"><i><b>I</b></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="underline" title="Underline (Ctrl+U)"><u><b>U</b></u></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="strikeThrough" title="Strikethrough"><s>ab</s></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="subscript" title="Subscript">X<sub>2</sub></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="superscript" title="Superscript">X<sup>2</sup></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="removeFormat" title="Clear Formatting"><i class="fas fa-eraser"></i></button>
                                        </div>
                                    </div>
                                    <div class="ribbon-separator"></div>

                                    <!-- ═══════════ COLORS SECTION ═══════════ -->
                                    <div class="ribbon-section" title="Colors">
                                        <div class="ribbon-section-label">Colors</div>
                                        <div class="ribbon-group">
                                            <div class="color-btn-wrapper">
                                                <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="hiliteColor" title="Highlight Color">
                                                    <i class="fas fa-pen" id="hiliteIcon"></i>
                                                    <span class="color-bar" id="hiliteColorBar" style="background:#ffff00;"></span>
                                                </button>
                                                <input type="color" id="hiliteColorPicker" value="#ffff00">
                                            </div>
                                            <div class="color-btn-wrapper">
                                                <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="foreColor" title="Font Color">
                                                    <span style="font-weight:bold;" id="fontColorIcon">A</span>
                                                    <span class="color-bar" id="fontColorBar" style="background:#ff0000;"></span>
                                                </button>
                                                <input type="color" id="fontColorPicker" value="#ff0000">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ROW 2: Paragraph | Insert | Table | Image | View -->
                                <div class="ribbon-row-compact">

                                    <!-- ═══════════ PARAGRAPH SECTION ═══════════ -->
                                    <div class="ribbon-section" title="Paragraph">
                                        <div class="ribbon-section-label">Paragraph</div>
                                        <div class="ribbon-group">
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="justifyLeft" title="Align Left"><i class="fas fa-align-left"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="justifyCenter" title="Center"><i class="fas fa-align-center"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="justifyRight" title="Align Right"><i class="fas fa-align-right"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="justifyFull" title="Justify"><i class="fas fa-align-justify"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="insertUnorderedList" title="Bullets"><i class="fas fa-list-ul"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="insertOrderedList" title="Numbering"><i class="fas fa-list-ol"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="outdent" title="Decrease Indent"><i class="fas fa-outdent"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="indent" title="Increase Indent"><i class="fas fa-indent"></i></button>
                                            <div class="btn-group">
                                                <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" title="Line Spacing">
                                                    <i class="fas fa-arrows-alt-v"></i>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a class="dropdown-item" href="#" onclick="setLineSpacing(1.0);return false;">1.0</a></li>
                                                    <li><a class="dropdown-item" href="#" onclick="setLineSpacing(1.15);return false;">1.15</a></li>
                                                    <li><a class="dropdown-item" href="#" onclick="setLineSpacing(1.5);return false;">1.5</a></li>
                                                    <li><a class="dropdown-item" href="#" onclick="setLineSpacing(2.0);return false;">2.0</a></li>
                                                    <li><a class="dropdown-item" href="#" onclick="setLineSpacing(2.5);return false;">2.5</a></li>
                                                    <li><a class="dropdown-item" href="#" onclick="setLineSpacing(3.0);return false;">3.0</a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="ribbon-separator"></div>

                                    <!-- ═══════════ INSERT SECTION ═══════════ -->
                                    <div class="ribbon-section" title="Insert">
                                        <div class="ribbon-section-label">Insert</div>
                                        <div class="ribbon-group">
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="createLink" title="Insert Link (Ctrl+K)"><i class="fas fa-link"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="unlink" title="Remove Link"><i class="fas fa-unlink"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="pasteImage" title="Insert Image"><i class="fas fa-image"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" data-cmd="insertHorizontalRule" title="Horizontal Line"><i class="fas fa-minus"></i></button>
                                        </div>
                                    </div>
                                    <div class="ribbon-separator"></div>

                                    <!-- ═══════════ TABLE SECTION ═══════════ -->
                                    <div class="ribbon-section" title="Table">
                                        <div class="ribbon-section-label">Table</div>
                                        <div class="ribbon-group">
                                            <div class="btn-group">
                                                <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" title="Insert Table">
                                                    <i class="fas fa-table"></i>
                                                </button>
                                                <div class="dropdown-menu table-picker-dropdown p-2">
                                                    <div class="table-picker-label mb-1 text-center small">Insert Table</div>
                                                    <div class="table-picker" id="tablePicker"></div>
                                                    <div class="table-picker-size text-center small mt-1" id="tablePickerSize">0 × 0</div>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="insertTableRow('above')" title="Row Above"><i class="fas fa-level-up-alt"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="insertTableRow('below')" title="Row Below"><i class="fas fa-level-down-alt"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="insertTableColumn('left')" title="Column Left"><i class="fas fa-caret-square-left"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="insertTableColumn('right')" title="Column Right"><i class="fas fa-caret-square-right"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="deleteTableRow()" title="Delete Row"><i class="fas fa-minus-square"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="deleteTableColumn()" title="Delete Column"><i class="fas fa-columns"></i><i class="fas fa-times" style="font-size:6px;position:relative;top:-4px;"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="toggleSelectedTableBorders()" title="Toggle Table Borders (Word style)"><i class="fas fa-border-all"></i></button>
                                        </div>
                                    </div>
                                    <div class="ribbon-separator"></div>

                                    <!-- ═══════════ IMAGE SECTION ═══════════ -->
                                    <div class="ribbon-section" title="Image">
                                        <div class="ribbon-section-label">Image</div>
                                        <div class="ribbon-group">
                                            <button type="button" class="btn btn-sm btn-outline-secondary" id="toggleTextWrapBtn" onclick="toggleImageTextWrap()" title="Toggle Text Wrap (multiline/single line)">
                                                <i class="fas fa-align-left" id="textWrapIcon"></i><i class="fas fa-image" style="font-size:7px;margin-left:1px;"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="floatSelectedImage('left')" title="Float Left"><i class="fas fa-arrow-left"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="floatSelectedImage('right')" title="Float Right"><i class="fas fa-arrow-right"></i></button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="floatSelectedImage('none')" title="No Float"><i class="fas fa-ban"></i></button>
                                        </div>
                                    </div>
                                    <div class="ribbon-separator"></div>

                                    <!-- ═══════════ VIEW SECTION ═══════════ -->
                                    <div class="ribbon-section" title="View">
                                        <div class="ribbon-section-label">View</div>
                                        <div class="ribbon-group">
                                            <button type="button" class="btn btn-sm btn-outline-secondary" id="toggleInvisiblesBtn" onclick="toggleInvisibleSymbols()" title="Show/Hide Invisible Symbols (¶ ↵)">
                                                <i class="fas fa-paragraph" id="invisiblesIcon"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary theme-toggle-btn" id="themeToggleBtn" onclick="toggleTheme()" title="Dark/Light Theme">
                                                <i class="fas fa-moon" id="themeIcon"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- END TOOLBAR -->

                            <!-- ============================================
                                 RICH TEXT EDITOR
                                 Contenteditable div that serves as the email
                                 body editor. Supports:
                                 - Rich text formatting
                                 - Image paste/insert
                                 - Image resize by drag
                                 - Ctrl+V image paste
                                 ============================================ -->
                            <div id="editor" class="editor-container flex-grow-1" contenteditable="true" title="Email body editor - Type text, paste images (Ctrl+V), drag to resize images, right-click for context menu" th:style="'color:' + ${editorDefaultTextColor}">
                                <p th:style="'color:' + ${editorDefaultTextColor}">Type your email here...</p>
                            </div>
                        </div>
                        <!-- END MESSAGE EDITOR SECTION -->

                        <!-- ================================================
                             COMPOSE FOOTER
                             Fixed at bottom of compose card:
                             - Template save/load buttons
                             - Send mode options (Individual/Batch)
                             - Test send & Send All buttons
                             ================================================ -->
                        <div class="compose-footer">

                            <!-- Template Management and Export Buttons -->
                            <div class="template-buttons d-flex flex-wrap align-items-center gap-2">
                                <div class="template-group">
                                    <strong title="Save current subject and message to a template slot">Save as Template:</strong>
                                    <th:block th:each="i : ${#numbers.sequence(1, templateSlots)}">
                                        <button
                                            type="button"
                                            class="btn btn-sm btn-outline-primary js-template-save"
                                            th:attr="data-template-slot=${i}"
                                            th:title="'Save to template slot ' + ${i}"
                                            th:text="${i}">1</button>
                                    </th:block>
                                    <strong class="ms-2" title="Load a previously saved template">Load:</strong>
                                    <th:block th:each="i : ${#numbers.sequence(1, templateSlots)}">
                                        <button
                                            type="button"
                                            class="btn btn-sm btn-outline-secondary js-template-load"
                                            th:id="'loadBtn' + ${i}"
                                            th:attr="data-template-slot=${i}"
                                            th:title="'Load template from slot ' + ${i}"
                                            th:text="${i}">1</button>
                                    </th:block>
                                </div>
                                <div class="export-group ms-3">
                                    <strong title="Export email content to file">Export:</strong>
                                    <button type="button" class="btn btn-sm btn-outline-danger" onclick="exportToPdf()" title="Export to PDF - Download email as PDF file">
                                        <i class="fas fa-file-pdf"></i> PDF
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-info" onclick="exportToDocx()" title="Export to Word - Download email as Microsoft Word (.docx) file">
                                        <i class="fas fa-file-word"></i> Word
                                    </button>
                                </div>
                            </div>

                            <!-- Send Options Panel with Publishing Checkboxes on Left, Send Modes on Right -->
                            <div class="send-options mt-2 p-2 border rounded bg-light" title="Configure how messages are sent - select publishing destinations and sending mode">
                                <div class="row align-items-start">
                                    <!-- LEFT SIDE: Publishing Checkboxes -->
                                    <div class="col-auto publishing-options" title="Select where to publish your message">
                                        <div class="form-check" title="Post this message to your Facebook page">
                                            <input class="form-check-input" type="checkbox" id="publishFacebook" title="Enable to publish this message to Facebook">
                                            <label class="form-check-label" for="publishFacebook" title="Post to Facebook page"><i class="fab fa-facebook text-primary" title="Facebook"></i> Publish to Facebook</label>
                                        </div>
                                        <div class="form-check" title="Post this message to your Instagram account">
                                            <input class="form-check-input" type="checkbox" id="publishInstagram" title="Enable to publish this message to Instagram">
                                            <label class="form-check-label" for="publishInstagram" title="Post to Instagram"><i class="fab fa-instagram text-danger" title="Instagram"></i> Publish to Instagram</label>
                                        </div>
                                        <div class="form-check" title="Send emails to selected recipients">
                                            <input class="form-check-input" type="checkbox" id="sendEmailRecipients" checked title="Enable to send email to recipients in the list">
                                            <label class="form-check-label" for="sendEmailRecipients" title="Send via email"><i class="fas fa-envelope text-info" title="Email"></i> Send emails to recipients</label>
                                        </div>
                                    </div>

                                    <!-- RIGHT SIDE: Send Mode Options (vertically stacked) -->
                                    <div class="col send-mode-options" title="Choose how emails are sent to recipients">
                                        <!-- Individual Mode Row -->
                                        <div class="send-mode-row mb-2" title="Send emails one at a time to each recipient individually">
                                            <div class="form-check" title="Select this mode to send separate email to each recipient">
                                                <input class="form-check-input" type="radio" name="sendModeRadio" id="sendModeIndividual" value="individual" checked onchange="document.getElementById('sendMode').value='individual'" title="Send one email per recipient sequentially">
                                                <label class="form-check-label send-mode-label" for="sendModeIndividual" title="Send Messages → One by one: Each recipient receives their own email">
                                                    <strong>Send Messages → One by one</strong>
                                                </label>
                                            </div>
                                            <div class="send-mode-controls" title="Options for one-by-one sending mode">
                                                <select class="form-select form-select-sm" id="addressMode" title="Address field type - To: recipient visible, BCC: recipient hidden">
                                                    <option value="to" title="Recipient address shown in To field">To</option>
                                                    <option value="bcc" title="Recipient address hidden in BCC field">BCC</option>
                                                </select>
                                            </div>
                                        </div>
                                        <!-- Batch Mode Row -->
                                        <div class="send-mode-row mb-2" title="Send emails to multiple recipients at once in batches">
                                            <div class="form-check" title="Select this mode to send one email to multiple recipients">
                                                <input class="form-check-input" type="radio" name="sendModeRadio" id="sendModeBatch" value="batch" onchange="document.getElementById('sendMode').value='batch'" title="Send to multiple recipients per email message">
                                                <label class="form-check-label send-mode-label" for="sendModeBatch" title="Send Messages → Batch: Multiple recipients per email">
                                                    <strong>Send Messages → Batch</strong>
                                                </label>
                                            </div>
                                            <div class="send-mode-controls" title="Options for batch sending mode">
                                                <select class="form-select form-select-sm" id="batchAddressMode" title="Address field type - BCC: recipients hidden from each other, To: recipients visible">
                                                    <option value="bcc" selected title="Recipients hidden from each other (recommended)">BCC</option>
                                                    <option value="to" title="All recipients visible to each other">To</option>
                                                </select>
                                                <label class="ms-2 me-1" title="How many recipients per batch email">Size:</label>
                                                <input type="number" class="form-control form-control-sm" id="batchSize" value="2" min="1" max="50" title="Number of recipients per batch email (1-50). Larger batches are faster but may trigger spam filters.">
                                                <label class="ms-2 me-1" title="Time to wait between sending each email or batch"><i class="fas fa-clock text-secondary"></i> Delay (for both options):</label>
                                                <input type="number" class="form-control form-control-sm" id="sendDelay" value="500" min="0" max="60000" title="Milliseconds to wait between sends (0-60000). Higher values reduce server load.">
                                                <span class="text-muted ms-1" title="Milliseconds">ms</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Hidden field to track current send mode -->
                                <input type="hidden" id="sendMode" value="individual" title="Current send mode value">
                            </div>

                            <!-- Action Buttons Row -->
                            <div class="d-flex justify-content-between align-items-center mt-3" title="Send controls and status">
                                <div class="d-flex align-items-center" title="Test and status controls">
                                    <!-- Test Send Button - shows first email from list -->
                                    <button class="btn btn-outline-secondary" id="sendTestBtn" onclick="sendTestEmail()" title="Send a test email to verify your message looks correct before sending to all recipients">
                                        <i class="fas fa-paper-plane" title="Send test"></i> Send Test email to: <span id="testEmailTarget" th:text="${emails != null && !emails.isEmpty() ? emails.get(0) : 'N/A'}" title="Test recipient address">N/A</span>
                                    </button>
                                    <!-- Connection Status Badge (updated via JS) -->
                                    <span id="connectionStatus" class="ms-2 badge bg-secondary" title="Mail server connection status - green means connected, red means disconnected. Checked automatically every 20 seconds."><i class="fas fa-plug" title="Connection indicator"></i> Checking...</span>
                                    <!-- Send Progress Status Line (hidden by default) -->
                                    <span id="sendStatusLine" class="ms-3 text-muted small" style="display:none;" title="Shows progress: sent count, success count, and failure count during sending"></span>
                                </div>
                                <div class="d-flex align-items-center" title="Send action buttons">
                                    <!-- Stop Button (disabled by default, enabled during sending) -->
                                    <button class="btn btn-danger btn-stop" id="stopBtn" onclick="stopSending()" disabled title="Click to immediately stop the email sending process. Emails already sent cannot be recalled.">
                                        <i class="fas fa-stop" title="Stop sending"></i> Stop
                                    </button>
                                    <!-- Main Send Button -->
                                    <button class="btn btn-primary btn-send" onclick="sendEmails()" title="Start sending emails to all selected recipients using the configured send mode (One by one or Batch)"><i class="fas fa-mail-bulk" title="Send emails"></i> Send to All Selected</button>
                                </div>
                            </div>
                        </div>
                        <!-- END COMPOSE FOOTER -->

                    </div>
                </div>
            </div>
            <!-- END LEFT COLUMN -->

            <!-- ============================================================
                 RESIZABLE DIVIDER
                 Allows user to resize the two columns by dragging
                 ============================================================ -->
            <div class="column-resizer" id="columnResizer" title="Drag to resize columns"></div>

            <!-- ============================================================
                 RIGHT COLUMN - RECIPIENTS LIST
                 Contains:
                 - Search filter
                 - Select All/None/Add buttons
                 - Scrollable email list with checkboxes
                 - Bulk edit button
                 ============================================================ -->
            <div class="col-recipients">
                <div class="card h-100">
                    <!-- Card Header with recipient count -->
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span title="Email recipient list management"><i class="fas fa-users"></i> Recipients</span>
                        <!-- Total email count (from Thymeleaf model) -->
                        <span class="badge bg-light text-dark" th:text="${emailCount}" title="Total number of email addresses in the list">0</span>
                    </div>
                    <div class="card-body d-flex flex-column">

                        <!-- Search Filter -->
                        <div class="search-box">
                            <input type="text" class="form-control form-control-sm" id="searchEmail" placeholder="Search emails..." oninput="filterEmails()" title="Filter email list - type to search recipients">
                        </div>

                        <!-- Selection Buttons -->
                        <div class="select-buttons">
                            <button class="btn btn-sm btn-outline-primary" onclick="selectAll()" title="Select all recipients in the list"><i class="fas fa-check-double"></i> All</button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="deselectAll()" title="Deselect all recipients"><i class="fas fa-times"></i> None</button>
                            <button class="btn btn-sm btn-outline-success" onclick="showAddEmailModal()" title="Add a new email address to the list"><i class="fas fa-plus"></i> Add</button>
                        </div>

                        <!-- Selection Statistics -->
                        <div class="email-stats mb-2" title="Number of selected recipients out of total">Selected: <span id="selectedCount">0</span> / <span th:text="${emailCount}">0</span></div>

                        <!-- Scrollable Email List -->
                        <div class="email-list-container flex-grow-1" id="emailListContainer" title="Check/uncheck to select recipients, click trash icon to remove">
                            <!-- Thymeleaf loop: renders one row per email -->
                            <div th:each="email, iterStat : ${emails}" class="email-item">
                                <span class="email-number" th:text="${iterStat.index + 1}" title="Row number">1</span>
                                <input type="checkbox" class="email-checkbox" th:value="${email}" checked onchange="updateSelectedCount()" title="Select/deselect this recipient">
                                <span class="email-text" th:text="${email}" title="Recipient email address">email@example.com</span>
                                <span class="delete-btn" th:data-email="${email}" onclick="removeEmail(this.dataset.email)" title="Remove this email from the list"><i class="fas fa-trash-alt"></i></span>
                            </div>
                        </div>

                        <!-- Bulk Edit Button -->
                        <div class="mt-2">
                            <button class="btn btn-sm btn-outline-warning w-100" onclick="showBulkEditModal()" title="Edit the entire email list in a text area - one email per line"><i class="fas fa-edit"></i> Bulk Edit</button>
                        </div>

                    </div>
                </div>
            </div>
            <!-- END RIGHT COLUMN -->

        </div>
    </div>
    <!-- END MAIN CONTAINER -->

    <!-- ==================================================================
         ERROR CONSOLE PANEL
         Slide-up panel showing failed email sends.
         Positioned above the status bar.
         ================================================================== -->
    <div id="errorConsole" class="error-console" style="display:none;" title="List of failed email sends">
        <div class="error-console-header">
            <span title="Number of send errors"><i class="fas fa-exclamation-triangle"></i> Errors (<span id="errorCount">0</span>)</span>
            <button type="button" class="btn btn-sm btn-outline-light" onclick="toggleErrorConsole()" title="Close error console"><i class="fas fa-times"></i></button>
        </div>
        <div class="error-console-body" id="errorConsoleBody" title="Error details">
            <!-- Error items populated by JavaScript -->
        </div>
    </div>

    <!-- ==================================================================
         STATUS BAR
         Fixed at bottom of viewport.
         Shows current status and progress during send operations.
         ================================================================== -->
    <div class="status-bar" title="Application status and progress">
        <div class="d-flex justify-content-between align-items-center">
            <div><span id="statusText" title="Current operation status">Ready</span></div>
            <div class="progress-container" id="progressContainer" style="width: 300px;" title="Email sending progress">
                <div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated" id="progressBar" style="width: 0%" title="Percentage of emails sent"></div></div>
            </div>
        </div>
    </div>

    <!-- ==================================================================
         MODAL DIALOGS
         ================================================================== -->

    <!-- Result Modal - Shows success/error after operations -->
    <div class="modal fade result-modal" id="resultModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" id="resultModalHeader">
                    <h5 class="modal-title" id="resultModalTitle">Result</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="resultModalBody"></div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button></div>
            </div>
        </div>
    </div>

    <!-- Add Email Modal - Single email input dialog -->
    <div class="modal fade" id="addEmailModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Add Email</h5><button type="button" class="btn-close" data-bs-dismiss="modal" title="Close dialog"></button></div>
                <div class="modal-body"><input type="email" class="form-control" id="newEmail" placeholder="Enter email address..." title="Type a valid email address to add to the list"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" title="Cancel and close dialog">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addEmail()" title="Add this email to the recipient list">Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Edit Modal - Textarea for editing entire email list -->
    <div class="modal fade" id="bulkEditModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Bulk Edit Email List</h5><button type="button" class="btn-close" data-bs-dismiss="modal" title="Close dialog"></button></div>
                <div class="modal-body">
                    <p class="text-muted" title="Instructions for editing">One email per line or separate with semicolons:</p>
                    <textarea class="form-control" id="bulkEmails" rows="15" style="font-family: monospace;" title="Edit email addresses - one per line or semicolon-separated"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" title="Cancel changes and close dialog">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveBulkEmails()" title="Save changes to the email list">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Configuration Modal -->
    <div class="modal fade" id="configModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title"><i class="fas fa-cog"></i> Configuration</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="configForm">
              <div class="row g-3">
                <div class="col-md-6">
                  <h6>SMTP</h6>
                  <label class="form-label">Host</label>
                  <input type="text" class="form-control" name="spring.mail.host">
                  <label class="form-label mt-2">Port</label>
                  <input type="number" class="form-control" name="spring.mail.port">
                  <label class="form-label mt-2">Username</label>
                  <input type="text" class="form-control" name="spring.mail.username">
                  <label class="form-label mt-2">Password</label>
                  <input type="password" class="form-control" name="spring.mail.password" placeholder="••••••">
                  <small class="text-muted">Will be encrypted with Jasypt on save</small>
                </div>
                <div class="col-md-6">
                  <h6>Sender</h6>
                  <label class="form-label">From Address</label>
                  <input type="email" class="form-control" name="mail.from">
                  <label class="form-label mt-2">From Name</label>
                  <input type="text" class="form-control" name="mail.from.name">
                  <h6 class="mt-4">Editor</h6>
                  <label class="form-label">Default Text Color</label>
                  <select class="form-select" name="app.editor.default.text.color">
                    <option value="white">white</option>
                    <option value="black">black</option>
                  </select>
                  <label class="form-label mt-2">Template Slots</label>
                  <input type="number" class="form-control" name="app.template.slots" min="1" max="10">
                </div>
                <div class="col-md-12">
                  <h6>Facebook</h6>
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="facebookEnabledSwitch">
                    <label class="form-check-label" for="facebookEnabledSwitch">Enable Facebook</label>
                  </div>
                  <div class="row g-2 mt-1">
                    <div class="col-md-4">
                      <label class="form-label">Email</label>
                      <input type="email" class="form-control" name="facebook.email">
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Password</label>
                      <input type="password" class="form-control" name="facebook.password" placeholder="••••••">
                      <small class="text-muted">Will be encrypted with Jasypt on save</small>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Page ID</label>
                      <input type="text" class="form-control" name="facebook.page.id">
                    </div>
                    <div class="col-md-6 mt-2">
                      <label class="form-label">Access Token</label>
                      <input type="password" class="form-control" name="facebook.access.token" placeholder="••••••">
                      <small class="text-muted">Will be encrypted with Jasypt on save</small>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <span id="configStatus" class="text-muted me-auto"></span>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-outline-primary" onclick="saveConfiguration(true)">Save &amp; Close</button>
            <button type="button" class="btn btn-primary" onclick="saveConfiguration(false)">Save</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================================================================
         SCRIPTS
         - Bootstrap bundle (includes Popper for dropdowns)
         - Application JavaScript
         ================================================================== -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Pass server configuration to JavaScript -->
    <script th:inline="javascript">
        window.editorConfig = {
            defaultTextColor: /*[[${editorDefaultTextColor}]]*/ '#000000',
            templateSlots: /*[[${templateSlots}]]*/ 5
        };
    </script>
    <script src="/js/app.js"></script>
    <script>
    // Re-run table resizing on load so tables from templates get handles
    window.addEventListener('load', function() {
        if (typeof initTableResizing === 'function') {
            initTableResizing();
        }
    });
    </script>
</body>
</html>



